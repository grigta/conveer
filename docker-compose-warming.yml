# Warming Service extension for docker-compose
# Usage: docker-compose -f docker-compose.yml -f docker-compose-warming.yml up

version: '3.8'

services:
  # Warming Service
  warming-service:
    build:
      context: .
      dockerfile: ./services/warming-service/Dockerfile
    container_name: conveer-warming-service
    restart: always
    ports:
      - "50063:50063"
      - "8013:8013"
    environment:
      - SERVICE_NAME=warming-service
      - GRPC_PORT=50063
      - HTTP_PORT=8013
      - VK_SERVICE_URL=vk-service:50059
      - TELEGRAM_SERVICE_URL=telegram-service:50060
      - MAIL_SERVICE_URL=mail-service:50061
      - MAX_SERVICE_URL=max-service:50062
      - MONGO_URI=mongodb://admin:admin123@mongodb:27017
      - DATABASE_NAME=conveer
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://guest:guest@rabbitmq:5672/
      - LOG_LEVEL=info
      - WARMING_CONFIG_PATH=/app/configs/warming_config.yaml
      - WARMING_MAX_CONCURRENT_TASKS=50
      - WARMING_ENABLE_AUTO_START=true
    env_file:
      - .env
    depends_on:
      - mongodb
      - redis
      - rabbitmq
      - vk-service
      - telegram-service
      - mail-service
      - max-service
    volumes:
      - ./services/warming-service/configs:/app/configs
      - warming_profiles:/tmp/warming-profiles
    networks:
      - conveer-network
    shm_size: 2gb

volumes:
  warming_profiles:

networks:
  conveer-network:
    external: true